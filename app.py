import streamlit as st
import pandas as pd
import numpy as np
import joblib
from sklearn.linear_model import LogisticRegression
from sklearn.svm import SVC

# Set page configuration
st.set_page_config(page_title="Parkinson's Prediction", layout="centered")

# 1. Load the model and scaler
@st.cache_resource
def load_assets():
    # Attempt to load the files generated by your Jupyter Notebook
    model = joblib.load("best_parkinson_model.pkl")
    scaler = joblib.load("scaler.pkl")
    return model, scaler

try:
    model, scaler = load_assets()
    assets_loaded = True
except FileNotFoundError:
    st.error("Model or Scaler files not found.")
    assets_loaded = False

st.title("ðŸ§  Parkinson's  Analyzer")
st.write("Simplified analysis using the top indicator from each clinical section.")

if assets_loaded:
    st.subheader("Key Measurements")
    
    # Each section represented by its most important item
    # Values defaulted to typical 'Healthy' ranges to allow Negative results
    ppe = st.number_input("1. PPE (Pitch Period Entropy)", value=0.15, format="%.5f")
    fo = st.number_input("2. MDVP:Fo(Hz) - Average Frequency", value=190.00, format="%.2f")
    jitter_p = st.number_input("3. MDVP:Jitter(%)", value=0.003, format="%.5f")
    nhr = st.number_input("4. NHR (Noise-to-Harmonics)", value=0.01, format="%.5f")
    shimmer = st.number_input("5. MDVP:Shimmer", value=0.02, format="%.5f")
    rpde = st.number_input("6. RPDE (Signal Complexity)", value=0.35, format="%.5f")

    if st.button("Run Quick Analysis", type="primary", use_container_width=True):
        # BACKGROUND DATA: Using median 'Healthy' values for the 16 hidden features
        # This ensures that if the 6 user inputs are healthy, the result is Negative.
        features = np.array([[
            fo, 210.0, 150.0, jitter_p, 0.00002, 0.001, 0.002, 0.005,  # Freq & Jitter
            shimmer, 0.20, 0.01, 0.01, 0.01, 0.03,                    # Shimmer
            nhr, 25.0, rpde, 0.45, -6.5, 0.15, 2.0, ppe               # Noise & Others
        ]])
        
        # Apply scaling if required by your model type
        if isinstance(model, (LogisticRegression, SVC)):
            features = scaler.transform(features)
        
        prediction = model.predict(features)
        
        st.divider()
        if prediction[0] == 1:
            st.error("### Prediction: Positive")
            st.write("The indicators suggest patterns consistent with Parkinson's.")
        else:
            st.success("### Prediction: Negative")
            st.write("The indicators fall within the healthy range.")

else:
    st.info("ðŸ’¡ Ensure 'best_parkinson_model.pkl' and 'scaler.pkl' are in the script folder.")